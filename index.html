<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Echarts测试</title>
    <script _src="echarts.js"></script>
    <script src="https://cdn.bootcss.com/echarts/4.7.0/echarts.js"></script>
    <style>
.bc-switch{
  -webkit-appearance:none;
          appearance:none;
          
}
.bc-switch{
  position:relative;
  width:42px;
  height:22px;
  border:1px solid #DFDFDF;
  outline:0;
  border-radius:16px;
  box-sizing:border-box;
  background-color:#DFDFDF;
  -webkit-transition:background-color 0.1s, border 0.1s;
  transition:background-color 0.1s, border 0.1s;
  vertical-align: middle;
}
.bc-switch:before{
  content:" ";
  position:absolute;
  top:0;
  left:0;
  width:40px;
  height:20px;
  border-radius:15px;
  background-color:#FDFDFD;
  -webkit-transition:-webkit-transform 0.35s cubic-bezier(0.45, 1, 0.4, 1);
  transition:-webkit-transform 0.35s cubic-bezier(0.45, 1, 0.4, 1);
  transition:transform 0.35s cubic-bezier(0.45, 1, 0.4, 1);
  transition:transform 0.35s cubic-bezier(0.45, 1, 0.4, 1), -webkit-transform 0.35s cubic-bezier(0.45, 1, 0.4, 1);
}
.bc-switch:after{
  content:" ";
  position:absolute;
  top:0;
  left:0;
  width:20px;
  height:20px;
  border-radius:15px;
  background-color:#FFFFFF;
  box-shadow:0 1px 3px rgba(0, 0, 0, 0.4);
  -webkit-transition:-webkit-transform 0.35s cubic-bezier(0.4, 0.4, 0.25, 1.35);
  transition:-webkit-transform 0.35s cubic-bezier(0.4, 0.4, 0.25, 1.35);
  transition:transform 0.35s cubic-bezier(0.4, 0.4, 0.25, 1.35);
  transition:transform 0.35s cubic-bezier(0.4, 0.4, 0.25, 1.35), -webkit-transform 0.35s cubic-bezier(0.4, 0.4, 0.25, 1.35);
}
.bc-switch:checked{
  border-color:#07c160;
  background-color:#07c160;
}
.bc-switch:checked:before{
  -webkit-transform:scale(0);
          transform:scale(0);
}
.bc-switch:checked:after{
  -webkit-transform:translateX(20px);
          transform:translateX(20px);
}

.header{ text-align: center; margin-bottom:20px;}
.header h1{ margin: 20px auto 20px; padding: 0px;}
    </style>

</head>
<body>
    <div class="header">
        <h1>经济与管理学院 信息管理与信息系统专业 课程关系图谱</h1>
        <label>是否开启编辑关系模式：<input type="checkbox" class="bc-switch" id="btn_isedt" onclick="change_editing_status(this)" /></label>
    </div>
    
    <div id="chart1" style="width: 1600px; height: 900px; margin: 0 auto; "></div>
</body>
 
    <script type="text/javascript">
        var d = {
    nodes:[
        //{id:'课程id',name:'课程名称',category:'第几学期 0代表第一学期'},
{id:'1',name:'军训 ',category:'0',itemStyle:{
    //color:'#ff8',
}},
{id:'2',name:'入学教育 ',category:'0'},
{id:'3',name:'军事理论 ',category:'0'},
{id:'4',name:'管理学* ',category:'0'},
{id:'5',name:'管理科学与工程学科导论 ',category:'0'},
{id:'6',name:'中国近现代史纲要与实践 ',category:'0'},
{id:'7',name:'高等数学（经管）1 ',category:'0'},
{id:'8',name:'形势与政策1 ',category:'0'},
{id:'9',name:'英语1 ',category:'0'},
{id:'10',name:'大学计算机 ',category:'0'},
{id:'11',name:'思想道德修养与法律基础与实践 ',category:'0'},
{id:'12',name:'体育Ⅰ ',category:'0'},
{id:'13',name:'python语言课程设计 ',category:'1'},
{id:'14',name:'大学生创新基础 ',category:'1'},
{id:'15',name:'大学生职业生涯与发展规划 ',category:'1'},
{id:'16',name:'大学生心理健康 ',category:'1'},
{id:'17',name:'会计学基础 ',category:'1'},
{id:'18',name:'工业工程导论 ',category:'1'},
{id:'19',name:'当代世界经济与政治与实践 ',category:'1'},
{id:'20',name:'线性代数C ',category:'1'},
{id:'21',name:'python程序设计 ',category:'1'},
{id:'22',name:'形势与政策2 ',category:'1'},
{id:'23',name:'英语2 ',category:'1'},
{id:'24',name:'体育Ⅱ ',category:'1'},
{id:'25',name:'高等数学（经管）2 ',category:'1'},
{id:'26',name:'商务数据分析实战 ',category:'2'},
{id:'27',name:'工程训练C ',category:'2'},
{id:'28',name:'大学生创业基础 ',category:'2'},
{id:'29',name:'航空航天技术博览 ',category:'2'},
{id:'30',name:'民航概论 ',category:'2'},
{id:'31',name:'Web前端开发基础 ',category:'2'},
{id:'32',name:'电子商务运营管理* ',category:'2'},
{id:'33',name:'西方经济学 ',category:'2'},
{id:'34',name:'商务数据分析与工具 ',category:'2'},
{id:'35',name:'数据库原理及应用* ',category:'2'},
{id:'36',name:'马克思主义基本原理概论与实践 ',category:'2'},
{id:'37',name:'概率论与数理统计C ',category:'2'},
{id:'38',name:'形势与政策3 ',category:'2'},
{id:'39',name:'英语3 ',category:'2'},
{id:'40',name:'体育Ⅲ ',category:'2'},
{id:'41',name:'网络营销学B ',category:'3'},
{id:'42',name:'操作系统原理 ',category:'3'},
{id:'43',name:'C语言课程设计 ',category:'3'},
{id:'44',name:'数字媒体设计 ',category:'3'},
{id:'45',name:'C语言程序设计 ',category:'3'},
{id:'46',name:'管理统计学 ',category:'3'},
{id:'47',name:'生产运作管理* ',category:'3'},
{id:'48',name:'毛泽东思想和中国特色社会主义理论体系概论与实践 ',category:'3'},
{id:'49',name:'英语4 ',category:'3'},
{id:'50',name:'形势与政策4 ',category:'3'},
{id:'51',name:'体育Ⅳ ',category:'3'},
{id:'52',name:'信息管理专业实习 ',category:'4'},
{id:'53',name:'商务网站模拟与实现 ',category:'4'},
{id:'54',name:'社会实践 ',category:'4'},
{id:'55',name:'大学生择业与就业指导 ',category:'4'},
{id:'56',name:'人工智能 ',category:'4'},
{id:'57',name:'机场运营管理 ',category:'4'},
{id:'58',name:'专业外语阅读 ',category:'4'},
{id:'59',name:'数据结构与算法* ',category:'4'},
{id:'60',name:'商务网站设计与实现* ',category:'4'},
{id:'61',name:'项目管理* ',category:'4'},
{id:'62',name:'管理信息系统* ',category:'4'},
{id:'63',name:'管理运筹学* ',category:'4'},
{id:'64',name:'形势与政策5 ',category:'4'},
{id:'65',name:'经营管理虚拟仿真实验 ',category:'5'},
{id:'66',name:'经济数学 ',category:'5'},
{id:'67',name:'数据可视化 ',category:'5'},
{id:'68',name:'智能手机应用系统开发 ',category:'5'},
{id:'69',name:'数据统计与挖掘 ',category:'5'},
{id:'70',name:'计算机网络技术基础* ',category:'5'},
{id:'71',name:'信息资源管理* ',category:'5'},
{id:'72',name:'经济法 ',category:'5'},
{id:'73',name:'ERP原理与软件应用 ',category:'5'},
{id:'74',name:'形势与政策6 ',category:'5'},
{id:'75',name:'毕业实习 ',category:'6'},
{id:'76',name:'管理信息系统设计 ',category:'6'},
{id:'77',name:'公益劳动 ',category:'6'},
{id:'78',name:'创新创业实践 ',category:'6'},
{id:'79',name:'信息安全管理 ',category:'6'},
{id:'80',name:'跨境电子商务 ',category:'6'},
{id:'81',name:'物流信息管理 ',category:'6'},
{id:'82',name:'信息系统分析与设计* ',category:'6'},
{id:'83',name:'毕业设计（论文） ',category:'7'},
{id:'84',name:'毕业教育 ',category:'7'},



    ],

    links:[
        //{source: '课程id', target: '后id'}
        {source: '1', target: '13'},
        {source: '1', target: '14'},
        {source: '2', target: '13'},
        {source: '6', target: '81'},
        {source: '1', target: '73'},
        {source: '12', target: '84'},
        {source: '11', target: '83'},
        {source: '13', target: '84'},
        {source: '11', target: '81'},
        {source: '1', target: '70'},
        {source: '14', target: '82'},
        {source: '9', target: '75'},
        {source: '19', target: '84'},
        {source: '15', target: '79'},
        {source: '0', target: '63'},
        {source: '2', target: '65'},
        {source: '17', target: '78'},
        {source: '2', target: '60'},
        {source: '23', target: '81'},
        {source: '13', target: '71'},
        {source: '6', target: '63'},
        {source: '5', target: '61'},
        {source: '15', target: '71'},
        {source: '11', target: '66'},
        {source: '3', target: '57'},
        {source: '21', target: '74'},
        {source: '8', target: '60'},
        {source: '10', target: '62'},
        {source: '31', target: '83'},
        {source: '0', target: '52'},
        {source: '0', target: '52'},
        {source: '1', target: '53'},
        {source: '14', target: '65'},
        {source: '14', target: '64'},
        {source: '35', target: '84'},
        {source: '26', target: '74'},
        {source: '30', target: '77'},
        {source: '20', target: '66'},
        {source: '38', target: '84'},
        {source: '32', target: '77'},
        {source: '10', target: '55'},
        {source: '38', target: '82'},
        {source: '36', target: '80'},
        {source: '17', target: '61'},
        {source: '27', target: '70'},
        {source: '23', target: '66'},
        {source: '12', target: '55'},
        {source: '19', target: '62'},
        {source: '15', target: '57'},
        {source: '17', target: '58'},
        {source: '7', target: '48'},
        {source: '42', target: '82'},
        {source: '5', target: '45'},
        {source: '39', target: '79'},
        {source: '15', target: '55'},
        {source: '39', target: '79'},
        {source: '35', target: '74'},
        {source: '12', target: '51'},
        {source: '6', target: '44'},
        {source: '37', target: '74'},
        {source: '34', target: '71'},
        {source: '47', target: '83'},
        {source: '48', target: '84'},
        {source: '44', target: '80'},
        {source: '46', target: '82'},
        {source: '29', target: '64'},
        {source: '24', target: '59'},
        {source: '18', target: '53'},
        {source: '10', target: '45'},
        {source: '49', target: '83'},
        {source: '13', target: '47'},
        {source: '11', target: '45'},
        {source: '24', target: '58'},
        {source: '38', target: '72'},
        {source: '9', target: '42'},
        {source: '29', target: '61'},
        {source: '8', target: '40'},
        {source: '23', target: '55'},
        {source: '1', target: '33'},
        {source: '19', target: '50'},
        {source: '45', target: '76'},
        {source: '27', target: '58'},
        {source: '49', target: '79'},
        {source: '21', target: '51'},
        {source: '18', target: '48'},
        {source: '45', target: '75'},
        {source: '44', target: '73'},
        {source: '54', target: '83'},
        {source: '2', target: '31'},
        {source: '35', target: '63'},
        {source: '9', target: '37'},
        {source: '17', target: '44'},
        {source: '42', target: '69'},
        {source: '49', target: '76'},
        {source: '51', target: '78'},
        {source: '51', target: '78'},
        {source: '57', target: '83'},
        {source: '57', target: '83'},
        {source: '57', target: '82'},
        {source: '19', target: '44'},
        {source: '28', target: '53'},
        {source: '33', target: '58'},
        {source: '6', target: '31'},
        {source: '21', target: '46'},
        {source: '4', target: '28'},
        {source: '4', target: '28'},
        {source: '24', target: '47'},
        {source: '36', target: '59'},
        {source: '3', target: '26'},
        {source: '58', target: '80'},
        {source: '40', target: '62'},
        {source: '49', target: '71'},
        {source: '36', target: '57'},
        {source: '34', target: '55'},
        {source: '26', target: '47'},
        {source: '19', target: '40'},
        {source: '25', target: '45'},
        {source: '19', target: '39'},
        {source: '58', target: '77'},
        {source: '56', target: '75'},
        {source: '54', target: '72'},
        {source: '44', target: '62'},
        {source: '18', target: '36'},
        {source: '52', target: '70'},
        {source: '34', target: '52'},
        {source: '30', target: '48'},
        {source: '49', target: '66'},
        {source: '35', target: '52'},
        {source: '27', target: '44'},
        {source: '68', target: '84'},
        {source: '20', target: '36'},
        {source: '66', target: '82'},
        {source: '62', target: '77'},
        {source: '2', target: '17'},
        {source: '43', target: '58'},
        {source: '31', target: '45'},
        {source: '66', target: '80'},
        {source: '68', target: '82'},
        {source: '10', target: '24'},
        {source: '2', target: '16'},
        {source: '40', target: '52'},
        {source: '44', target: '56'},
        {source: '0', target: '12'},
        {source: '4', target: '16'},
        {source: '73', target: '84'},
        {source: '73', target: '84'},
        {source: '49', target: '60'},
        {source: '21', target: '30'},
        {source: '9', target: '18'},
        {source: '0', target: '9'},
        {source: '11', target: '20'},
        {source: '31', target: '40'},
        {source: '55', target: '63'},
        {source: '38', target: '46'},
        {source: '21', target: '29'},
        {source: '12', target: '20'},
        {source: '1', target: '9'},
        {source: '29', target: '37'},
        {source: '16', target: '24'},
        {source: '49', target: '56'},
        {source: '15', target: '22'},
        {source: '2', target: '9'},
        {source: '42', target: '49'},
        {source: '28', target: '35'},
        {source: '67', target: '74'},
        {source: '79', target: '84'},
        {source: '55', target: '60'},
        {source: '66', target: '71'},
        {source: '44', target: '49'},
        {source: '77', target: '82'},
        {source: '50', target: '55'},
        {source: '37', target: '42'},
        {source: '67', target: '71'},
        {source: '19', target: '23'},
        {source: '48', target: '52'},
        {source: '8', target: '12'},
        {source: '24', target: '27'},
        {source: '80', target: '83'},
        {source: '47', target: '50'},
        {source: '41', target: '44'},
        {source: '41', target: '43'},
        {source: '5', target: '7'},
        {source: '42', target: '44'},
        {source: '42', target: '44'},
        {source: '12', target: '13'},
        {source: '50', target: '51'},
        {source: '81', target: '82'},
        {source: '51', target: '52'},

    ]
};
        var key_word="key_word666";
    
        var data = d.nodes;  // echarts中的节点数组
        var links = d.links;  // echarts中边的数组
 
        // 获取实体1, 也就是中心节点
        // var node = {} ;
        // node['name'] = key_word;
        // node['draggable'] = true;  // 设置中心节点是否可以拖拽
        // var id = 0;
        // node['id'] = id.toString();
        // data.push(node);
 
        // 获取实体2, 存储在data中, 如果实体2已经存在于data中, 则不push
        // var maxDisPlayNode = 16;  // 对展示节点的数量进行限制
        // console.log("实体长度----->", entityRelation.length);  // 显示关系个数
        
        var xueqi = {},y_max = 0;
        for(var i = 0; i < d.nodes.length; i++) {
            var node = d.nodes[i];
            xueqi['s'+node.category]  = ++xueqi['s'+node.category] || 0;

            node.value=[ Number( node.category ) , xueqi['s'+node.category] ];

            y_max = Math.max(y_max, xueqi['s'+node.category] ); 
        }
        
        var yAxis_data = [];
        for( let i=0, len=y_max; i<=len ; i++ ){
            yAxis_data.push(i+1);
        }

        // 初始化echarts实例
        var myChart = echarts.init(document.getElementById("chart1"));
 
option = {

    animation: false,
    grid: {
        top: '10%',
        bottom: '10%',
        left: '5%',
        right: '12%'
    },
    xAxis: {
        boundaryGap:false,
        axisTick:{
            alignWithLabel:true,
        },

        position: 'top',
        type: 'category',
        data: ['1', '2', '3', '4', '5', '6', '7','8'],
        splitArea: {
            show: true
        },
        axisLabel: { 
            interval:0,//全部显示  
            formatter: '第{value}学期'
        },
    },
    yAxis: {
        inverse: true, //
        type: 'category',
        data: yAxis_data,  //[1,2,3,4,5,6,7,8]
        splitArea: {
            show: true
        },
        axisLabel: { 
            interval:0,//全部显示  
            formatter: '{value}    '
        },
    },
    // animationDuration: 1500,//初始动画的时长
    // animationEasingUpdate: 'quinticInOut',//数据更新动画的缓动效果
    series: [{
        type: 'graph',  //关系图
        layout: 'none',   //无布局 ||circular环形布局||'force' 采用力引导布局
        coordinateSystem: 'cartesian2d', // 使用二维的直角坐标系
        //
        // links: [
        //     {source: '003', target: '001'} ,
        //     {source: '003', target: '001'} ,
        // ],
        // data:[
        //    {
        //        id:'001',
        //        name:'c++',
        //        value:[0,1,233] // ***如果是数字 匹配数字下标  如果是字符串 匹配 值 ****
        //    },
        //    // {
        //    //     id:'002',
        //    //     name:'q++',
        //    //     value:[2,2]
        //    // },
        //    // {
        //    //     id:'003',
        //    //     name:'英语4',
        //    //     value:[0,2,233]
        //    // },
        //    // {
        //    //     id:'004',
        //    //     name:'这是一个超级长的课程名称',
        //    //     value:[0,3,233]
        //    // },
        // ],
        data:d.nodes,
        links:d.links,
        
        label: {
            show: true,
            color: '#333',
            //position: 'center ,center',
            position: 'right',
            formatter: '{title|{b}}',
            rich: {
                title: {
                    color: '#f88',
                    fontSize:'16',
                    backgroundColor:'#333',
                    padding:5,
                    borderRadius:5,
                    //align: 'center'
                },
            }
        },
        
        symbol : 'circle',//标记类型包括 'circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow', 'none'
        symbolSize: [15,15],//
        //项目符号样式
        itemStyle: {
            
            //color: 'yellow',
            shadowBlue: 9,
            shadowOffsetX: 1.5,
            shadowOffsetY: 3,
            shadowColor: '#555',
            // borderColor: '#fff',
            // borderWidth: 5,
            // shadowBlur: 100,
            // shadowColor: 'rgba(0, 0, 0, 0.3)'
        },

        edgeSymbol: ['none', 'arrow'], //'circle', 'arrow'
        edgeSymbolSize: [4, 10],
        //关系线
        lineStyle: {
            // color: '#D10E00',
            //color: 'source',
            width: 2,
            curveness: 0.15,
            opacity: 0.5
        },
        



        //是否在鼠标移到节点上的时候突出显示节点以及节点的边和邻接节点。 
        focusNodeAdjacency: false, 
        //高亮的图形样式。
        emphasis: {
            lineStyle: {
                width: 2,
                color: '#D10E00',
                opacity: 1
            }
        }
        

        
        

    }]
};
        var is_edit = 0;//是否连连看      
        function change_editing_status(obj){
            var obj = obj || document.getElementById("btn_isedt");
            if(obj.checked){
                is_edit = 1;
                option.series[0].focusNodeAdjacency = true;
            }else{
                is_edit = 0;
                option.series[0].focusNodeAdjacency = true;
            };
            myChart.setOption(option);//更新
        }change_editing_status();

       
        var newlink=[];//新关系
        myChart.setOption(option);  // 这步很重要, 必须设置才可以有效
        myChart.on('click',function (param){

            if(!is_edit){return}

            console.log('param---->', param);  // 打印出param, 可以看到里边有很多参数可以使用
            //获取节点点击的数组序号
            var arrayIndex = param.dataIndex;

            console.log('arrayIndex---->', arrayIndex);
            console.log('name---->', param.name);

            if (param.dataType == 'node') {

                //追加到数组中
                newlink.push(arrayIndex);
                option.series[0].data[arrayIndex].itemStyle={color: '#094'};
                myChart.setOption(option);//更新

                //if 一对 判断 添加 or 删除 关系
                if(newlink.length > 1 ){
                    //寻找关系是否存在
                    var del_link_index = myChart_getLink(newlink);

                    setTimeout(function(){
                        if( del_link_index == -1 ){
                            if( confirm('创建关系：['+option.series[0].data[newlink[0]].name+']->['+option.series[0].data[newlink[1]].name+']') ){
                                myChart_addLink(newlink);
                                
                            }
                        }else{
                            if( confirm('删除关系：['+option.series[0].data[newlink[0]].name+'] vs ['+option.series[0].data[newlink[1]].name+']') ){

                                myChart_delLink(del_link_index);
                                
                            }
                        }
                        //只要点了两个 就 删除 关系
                        newlink.map(function(v,i){
                            option.series[0].data[v].itemStyle={};
                        });
                        newlink=[];
                        myChart.setOption(option);//更新

                    },100); 
                }
                
            } else {
                alert("点击了边:  " + param.value)
            }
        });

        //寻找关系是否存在  -1不存在 || 0，1，2，... option.series[0].links[i] 里的i 等待删除关系 的索引
        function myChart_getLink(newlink){
            var t1 =  option.series[0].data[newlink[0]].id;
            var t2 =  option.series[0].data[newlink[1]].id;

            for(var i=0, len = option.series[0].links.length ; i<len; i++){
                //正关系
                if(option.series[0].links[i].source == t1 && option.series[0].links[i].target == t2){
                    console.log(newlink,i,option.series[0].links[i]);
                    return i;
                }
                //反关系
                if(option.series[0].links[i].source == t2 && option.series[0].links[i].target == t1){
                    console.log(newlink,i,option.series[0].links[i]);
                    return i;
                }
            }
            return -1;//没有找到
        }
        //删除关系 ：i=links的索引
        function myChart_delLink(i){
            var t1 = option.series[0].links[i].source;
            var t2 = option.series[0].links[i].source;

            //ajax
            del_link_ajax( t1, t2);
            //js数组 删除
            option.series[0].links.splice(i, 1);
            //提示
            //alert('删除成功');
            return ;
        }
        //添加关系：
        function myChart_addLink(newlink){
            var t1 = option.series[0].data[newlink[0]].id;
            var t2 = option.series[0].data[newlink[1]].id;
            var link = {source: t1, target: t2};

            //ajax
            
            add_link_ajax( t1, t2 );
            //js数组 删除
            option.series[0].links.push(link);
            //提示
            //
            return;
        }

        //ajax删除关系
        function del_link_ajax(t1, t2){
            console.log('del_link_ajax:', t1, t2 );
            alert('删除成功');
        }
        //ajax删除关系
        function add_link_ajax(t1, t2){
            console.log('add_link_ajax:', t1, t2 );
            alert('创建成功');
        }



    </script>
 
</html>
